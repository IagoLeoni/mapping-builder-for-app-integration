# Mapping Builder for Application Integration

## Not Google Product Clause
**‚ö†Ô∏è Disclaimer: This is not an officially supported Google product, nor is it part of any official Google product.**

A visual integration platform that serves as a customer-facing frontend for Google Cloud Application Integration. Enables clients to visually map payloads through a drag & drop interface and automatically generate deployable integrations.

üìÑ **[Documenta√ß√£o em Portugu√™s](./docs/pt-BR/README.md)**

## üèóÔ∏è Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Frontend      ‚îÇ    ‚îÇ    Backend      ‚îÇ    ‚îÇ  Google Cloud   ‚îÇ
‚îÇ   (React)       ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (Node.js)     ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ  Application    ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ  Integration    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Components

- **Frontend**: React interface with drag & drop for visual mapping
- **Backend**: Node.js API for validation and deployment
- **Google Cloud**: Application Integration for runtime execution

## üèóÔ∏è Detailed Architecture

### üìã System Overview

The Mapping Builder implements a system-agnostic 3-layer architecture that transforms visual mappings into deployable Google Cloud Application Integration integrations:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                           PRESENTATION LAYER                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   Schema Input  ‚îÇ  Mapping Canvas ‚îÇ  AI Assistant   ‚îÇ    JSON Preview         ‚îÇ
‚îÇ   - JSON Parse  ‚îÇ  - Drag & Drop  ‚îÇ  - Gemini 2.0   ‚îÇ    - Integration JSON   ‚îÇ
‚îÇ   - Validation  ‚îÇ  - Visual Links ‚îÇ  - Auto-detect  ‚îÇ    - Deploy Config      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                    ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                            BUSINESS LAYER                                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ GeminiMapping   ‚îÇ Transformation  ‚îÇ  Template       ‚îÇ    Integration          ‚îÇ
‚îÇ Service         ‚îÇ Engine          ‚îÇ  Service        ‚îÇ    Service              ‚îÇ
‚îÇ - AI Mapping    ‚îÇ - Data Transform‚îÇ  - JSON Gen     ‚îÇ    - Orchestration      ‚îÇ
‚îÇ - Semantic      ‚îÇ - Jsonnet       ‚îÇ  - PubSub DLQ   ‚îÇ    - Validation         ‚îÇ
‚îÇ - Recovery      ‚îÇ - Preview       ‚îÇ  - Variables    ‚îÇ    - Deployment         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                    ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         INFRASTRUCTURE LAYER                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Cloud Build    ‚îÇ Application     ‚îÇ   PubSub DLQ    ‚îÇ   Cloud Monitoring      ‚îÇ
‚îÇ  - CI/CD        ‚îÇ Integration     ‚îÇ   - Fail Handle ‚îÇ   - Logs & Metrics      ‚îÇ
‚îÇ  - Auto Deploy  ‚îÇ - Runtime Exec  ‚îÇ   - Reprocessing‚îÇ   - Error Tracking      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üîÑ Complete Flow: User Input ‚Üí Deployed Application Integration

```mermaid
graph TD
    A[üìù User Pastes Schema/Payload] --> B[üîç Schema Validation]
    B --> C{ü§ñ Use AI?}
    
    C -->|Yes| D[üß† Gemini 2.0 Flash]
    C -->|No| E[‚úã Manual Drag & Drop]
    
    D --> F[üéØ Mappings + Transformations]
    E --> F
    
    F --> G[‚öôÔ∏è TemplateService.generateIntegration]
    G --> H[üìã Application Integration JSON]
    
    H --> I[‚òÅÔ∏è Cloud Build Deploy]
    I --> J[üöÄ Google Cloud Application Integration]
    
    J --> K[üîó Active Webhook URL]
    K --> L[üì® Source System Sends Webhook]
    
    L --> M{‚úÖ REST Success?}
    M -->|Yes| N[‚úÖ SuccessOutputTask]
    M -->|No| O[üì§ PubSub DLQ Task]
    
    O --> P[üíæ dlq-pre-employee-moved Topic]
    P --> Q[üîÑ Reprocessing System]
```

### üß© Detailed Components

#### 1. **GeminiMappingService** - AI-Powered Auto Detection

**Location**: `backend/src/services/GeminiMappingService.ts`

**Responsibility**: Automatically map fields between source and target systems using Gemini 2.0 Flash AI

**How It Works**:

```typescript
// Single-shot processing for 190+ fields
async generateMappings(clientSchema: any, inputType: 'schema' | 'payload', sourceSystemId: string = 'hr-system') {
  // 1. Load reference schemas
  const sourceSchema = await SchemaManagerService.loadSourceSchema(sourceSystemId);
  const sourceExamplePayload = await SchemaManagerService.loadSourceSystemExamplePayload(sourceSystemId);
  
  // 2. Build comprehensive prompt
  const prompt = this.buildComprehensivePrompt(sourceSchema, sourceExamplePayload, clientSchema, semanticPatterns);
  
  // 3. Single call to Gemini 2.0 Flash
  const response = await this.callGeminiAPI(prompt);
  
  // 4. Parse with robust recovery system
  const mappings = this.parseResponseWithRecovery(response);
  
  return mappings; // 27+ mappings with 86.3% average confidence
}
```

**Special Capabilities**:
- ‚úÖ **Single-Shot Processing**: Processes 190+ fields in one call
- ‚úÖ **Recovery System**: Defensive algorithm against truncated JSON
- ‚úÖ **Adaptive Processing**: Smart batching for large payloads
- ‚úÖ **Confidence Normalization**: Normalizes percentage values to decimals

#### 2. **TransformationEngine** - Data Transformation Logic

**Location**: `backend/src/services/TransformationEngine.ts`

**Responsibility**: Apply data transformations (CPF, phone, names, etc.)

**Transformation Architecture**:

```typescript
interface TransformationConfig {
  type: 'format_document' | 'phone_split' | 'name_split' | 'country_code' | 'normalize' | 'format_date';
  operation: string;
  pattern?: string;
  parameters?: any;
  preview?: { input: string; output: string; };
}

// Main engine with switch case for each type
static applyTransformation(value: any, transformation: TransformationConfig): any {
  switch (transformation.type) {
    case 'format_document':
      return this.formatDocument(value, transformation); // CPF: "269.622.778-06" ‚Üí "26962277806"
    case 'phone_split':
      return this.splitPhone(value, transformation);     // "+5511999999999" ‚Üí {area: "11", number: "999999999"}
    case 'name_split':
      return this.splitName(value, transformation);      // "Jo√£o Silva" ‚Üí "Jo√£o"
    case 'country_code':
      return this.convertCountryCode(value, transformation); // "Brasil" ‚Üí "BRA"
    default:
      return value;
  }
}
```

#### 3. **TemplateService** - Template Generation

**Location**: `backend/src/services/TemplateService.ts`

**Responsibility**: Generate complete Google Cloud Application Integration JSON

**How Templates Are Generated**:

```typescript
// Main method that orchestrates entire generation
static generateIntegration(config: IntegrationConfig): any {
  const integrationId = `int-${Date.now()}`;
  const triggerName = config.integrationName || integrationId;
  
  // 1. Generate main tasks
  const fieldMappingTask = this.generateFieldMappingTask(config.customerEmail);
  const restTask = this.generateRestTask();
  const pubsubTask = this.generatePubSubTask(); // ‚≠ê NEW: DLQ System
  const successTask = this.generateSuccessOutputTask();
  
  // 2. Generate transformation tasks (Jsonnet)
  const transformationTasks = config.mappings
    .filter(m => m.transformation)
    .map((mapping, index) => this.generateJsonnetMapperTask(mapping, index));
  
  // 3. Assemble final Application Integration JSON
  return {
    "name": `projects/160372229474/locations/us-central1/integrations/${integrationId}/versions/1`,
    "updateTime": new Date().toISOString(),
    "triggerConfigs": [{
      "label": "API Trigger",
      "triggerType": "API",
      "triggerId": `api_trigger/${triggerName}`, // ‚≠ê NEW: Clean Trigger ID
      "startTasks": [{ "taskId": "1" }]
    }],
    "taskConfigs": [
      fieldMappingTask,  // taskId: 1
      restTask,          // taskId: 2  
      successTask,       // taskId: 5
      pubsubTask,        // taskId: 4 ‚≠ê NEW: Replaces EmailTask
      ...transformationTasks // taskIds: 10+
    ],
    "integrationParameters": [...], // Input/Output schemas
    "integrationConfigParameters": [...] // CONFIG variables
  };
}
```

### üîÑ **PubSub Dead Letter Queue (DLQ) System** ‚≠ê **CRITICAL FEATURE IMPLEMENTED**

#### **Business Context and Need**
We replaced the traditional EmailTask system with a PubSub Dead Letter Queue solution for robust integration failure handling. This change resolves critical scalability and configuration limitations.

#### **EmailTask Problems Solved**
- **‚ùå Corporate email dependency**: Complex SMTP configuration specific per client
- **‚ùå Scalability limitations**: Emails are not ideal for batch processing
- **‚ùå Dynamic variable problems**: Error context corrupted email variables
- **‚ùå No reprocessing**: Emails don't allow automatic retry

#### **PubSub Solution Implemented**
- **‚úÖ Asynchronous by design**: Batch processing, automatic retry and load balancing
- **‚úÖ Existing infrastructure**: Reuses already configured PubSub connection
- **‚úÖ Advanced monitoring**: Metrics, alerts and message tracking
- **‚úÖ Preserved payload**: Original systemPayload maintained for reprocessing

#### **DLQ System Architecture**

```
Source System Webhook ‚Üí FieldMappingTask ‚Üí RestTask (Client)
                                      ‚Üì (failure)
                               PubSubTask (DLQ)
                                      ‚Üì
                          Topic: "dlq-pre-employee-moved"
                                      ‚Üì
                            Reprocessing System
```

#### **Technical Specifications**

**PubSub Connection**:
```
projects/apigee-prd1/locations/us-central1/connections/pubsub-poc
```

**DLQ Topic**:
```
dlq-pre-employee-moved
```

**DLQ Payload**: Complete systemPayload converted to JSON string using native `TO_JSON` function

**Defined Schemas**:
- **Input Schema**: `{message: string, topic: string, attributes?: string}`
- **Output Schema**: `{messageId: string}` for tracking


#### Universal APIs

```typescript
// ‚≠ê NEW: Agnostic endpoints serving any system
router.get('/source-schema/:systemId?', async (req, res) => {
  const systemId = req.params.systemId || 'hr-system';
  const schema = await SchemaManagerService.loadSourceSchema(systemId);
  // Works for: hr-system, salesforce, workday, sap, etc.
});

router.post('/generate-mappings', async (req, res) => {
  const { sourceSystemId = 'hr-system' } = req.body;
  const mappings = await geminiService.generateMappings(clientSchema, inputType, sourceSystemId);
  // AI maps any source system automatically
});
```

#### Universal Templates

```
templates/
‚îî‚îÄ‚îÄ universal/              # ‚≠ê NEW: Templates working with any system
    ‚îú‚îÄ‚îÄ tasks/
    ‚îÇ   ‚îî‚îÄ‚îÄ pubsub-dlq-task.json
    ‚îî‚îÄ‚îÄ transformations/
        ‚îú‚îÄ‚îÄ document-format.jsonnet    # Remove document formatting
        ‚îú‚îÄ‚îÄ name-split.jsonnet         # Split names
        ‚îú‚îÄ‚îÄ phone-split.jsonnet        # Split phones  
        ‚îî‚îÄ‚îÄ country-code.jsonnet       # Convert country codes
```

### üìä Metrics and Performance

#### Current Capabilities
- **AI Processing**: Single-shot for 190+ fields in <5 seconds
- **JSON Generation**: Complete integration in <2 seconds
- **Deploy Pipeline**: Mapping ‚Üí Live in <5 minutes
- **AI Confidence**: 86.3% average with Gemini 2.0 Flash
- **Coverage**: 27+ typical automatic mappings

#### Functionality Evidence
- ‚úÖ **100% Functional System**: Zero known critical errors
- ‚úÖ **Deploy Pipeline**: Integration created ‚Üí published ‚Üí LIVE automatically  
- ‚úÖ **PubSub DLQ**: Robust failure handling system implemented
- ‚úÖ **System-Agnostic**: Universal architecture for any source system
- ‚úÖ **Confidence Fix**: Normalization implemented resolves deployment error

#### Core System Files

```
backend/src/services/
‚îú‚îÄ‚îÄ GeminiMappingService.ts   # üß† AI + Mapping algorithms
‚îú‚îÄ‚îÄ TransformationEngine.ts   # ‚öôÔ∏è Data transformation engine
‚îú‚îÄ‚îÄ TemplateService.ts        # üìã Application Integration JSON generation
‚îú‚îÄ‚îÄ IntegrationService.ts     # üéØ Complete orchestration
‚îî‚îÄ‚îÄ SchemaManagerService.ts   # üìÅ Universal schema management
```

## üöÄ Features

- ‚úÖ Visual drag & drop interface
- ‚úÖ Source System ‚Üí Target System payload mapping
- ‚úÖ **PubSub DLQ system for robust failure handling** ‚≠ê **NEW**
- ‚úÖ Automatic integration JSON generation
- ‚úÖ Auto-deploy to Google Cloud Application Integration
- ‚úÖ CI/CD pipeline with Cloud Build
- ‚úÖ Execution monitoring and logs

## üìã Prerequisites

- Node.js 18+
- Docker
- Google Cloud SDK
- Google Cloud account with Application Integration enabled

## üõ†Ô∏è Local Development

### Frontend

```bash
cd frontend
npm install
npm start
```

The application will be available at `http://localhost:3000`

### Backend

```bash
cd backend
npm install
npm run dev
```

The API will be available at `http://localhost:8080`

### Environment Variables

Create a `.env` file in the `backend` directory:

```env
NODE_ENV=development
PORT=8080
GOOGLE_CLOUD_PROJECT_ID=your-project-id
GOOGLE_CLOUD_REGION=us-central1
FRONTEND_URL=http://localhost:3000

# Gemini AI (optional - for automatic mapping)
GEMINI_API_KEY=your-gemini-api-key
```

### ü§ñ Gemini AI Configuration (Optional)

To enable automatic mapping with AI:

1. **Get API Key**:
   - Access: https://makersuite.google.com/app/apikey
   - Create a new API key
   - Copy the generated key

2. **Configure in Backend**:
   ```bash
   cd backend
   echo "GEMINI_API_KEY=your-api-key-here" >> .env
   ```

3. **Features with Gemini**:
   - ‚úÖ Automatic mapping based on semantics
   - ‚úÖ Intelligent field suggestions
   - ‚úÖ Naming pattern analysis
   - ‚úÖ Fallback to simple algorithm if API fails

**Note**: Without the API key, the system uses a local semantic pattern-based mapping algorithm.

## üê≥ Docker

### Local Build

```bash
# Backend
docker build -t mapping-builder-backend ./backend

# Frontend
docker build -t mapping-builder-frontend ./frontend
```

### Docker Compose

```bash
docker-compose up -d
```

## ‚òÅÔ∏è Deploy to Google Cloud

### 1. Configure Project

```bash
# Set project
export PROJECT_ID=your-project-id
gcloud config set project $PROJECT_ID

# Enable required APIs
gcloud services enable cloudbuild.googleapis.com
gcloud services enable run.googleapis.com
gcloud services enable integrations.googleapis.com
```

### 2. Deploy via Cloud Build

```bash
# Manual trigger
gcloud builds submit --config=deployment/cloudbuild.yaml

# Or configure automatic trigger
gcloud builds triggers create github \
  --repo-name=mapping-builder \
  --repo-owner=your-username \
  --branch-pattern="^main$" \
  --build-config=deployment/cloudbuild.yaml
```

### 3. Configure Permissions

```bash
# Service account for Application Integration
gcloud iam service-accounts create mapping-builder-integration \
  --display-name="Mapping Builder Integration Service Account"

# Add required roles
gcloud projects add-iam-policy-binding $PROJECT_ID \
  --member="serviceAccount:mapping-builder-integration@$PROJECT_ID.iam.gserviceaccount.com" \
  --role="roles/integrations.integrationAdmin"
```

## üìñ How to Use

### 1. Access the Interface

Navigate to the frontend URL deployed on Cloud Run.

### 2. Configure Integration

1. **Client Email**: Enter email for error notifications
2. **System Endpoint**: URL of the client system webhook

### 3. Map Fields

1. **Left Panel**: View source system payload structure
2. **Center Panel**: Drag fields to create mappings
3. **Right Panel**: Configure and view generated JSON

### 4. Deploy

Click "Deploy Integration" to create the integration in Google Cloud.

## üßπ **RECENT CODE CLEANUP IMPLEMENTATION** (August 2025)

### ‚úÖ **Optimized and Simplified Code**
The project underwent comprehensive cleanup to remove unused code:

- **22 files/folders removed** (~25% size reduction)
- **Simplified interface** without unnecessary Wizard components
- **Optimized build** to 164.01 kB (final bundle)
- **Cleaner code** focused only on essentials

### üìÅ **Removed Files**
- ‚ùå Obsolete manual test files (6 files)
- ‚ùå Duplicate schemas and redundant documentation
- ‚ùå Obsolete Jsonnet templates (complete folder)
- ‚ùå Unused Wizard components (2 complete folders)
- ‚ùå Obsolete integration templates

### üéØ **Optimized Interface**
- **Direct Schema Input**: Simplified JSON input in MappingCanvas
- **Core Drag & Drop**: Focus on main functionality
- **Zero Dead Dependencies**: 100% utilized code

## üîß Project Structure (Updated)

```
mapping-builder/
‚îú‚îÄ‚îÄ frontend/                 # React frontend (optimized)
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/      # Essential components
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ConfigPanel/     # Client configuration
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DebugPanel/      # Debug and monitoring  
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ JsonPreview/     # Integration preview
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MappingCanvas/   # Main drag & drop interface
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PayloadTree/     # Source system payload visualization
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/          # TypeScript definitions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/          # Core utilities
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ services/       # Frontend services
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ nginx.conf
‚îú‚îÄ‚îÄ backend/                 # Node.js backend
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/         # RESTful APIs
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deploy.ts       # Integration deployment
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gemini.ts       # AI mapping
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ integration.ts  # Integration management
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ transformations.ts # Transformation preview
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ services/       # Business services
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ CloudBuildService.ts     # Deploy automation
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ GeminiMappingService.ts  # AI mapping
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ IntegrationService.ts    # Integration generation
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ SchemaManagerService.ts  # Schema management
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ TemplateService.ts       # PubSub system
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ TransformationEngine.ts  # Transformation engine
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ schemas/                # Schemas and examples
‚îÇ   ‚îú‚îÄ‚îÄ source-systems/    # Source system schemas
‚îÇ   ‚îú‚îÄ‚îÄ target-systems/    # Target system schemas
‚îÇ   ‚îú‚îÄ‚îÄ examples/          # System examples
‚îÇ   ‚îî‚îÄ‚îÄ patterns/          # Semantic patterns
‚îú‚îÄ‚îÄ templates/             # Universal templates
‚îÇ   ‚îú‚îÄ‚îÄ universal/         # System-agnostic templates
‚îÇ   ‚îú‚îÄ‚îÄ source-systems/    # Source-specific templates
‚îÇ   ‚îî‚îÄ‚îÄ target-systems/    # Target-specific templates
‚îú‚îÄ‚îÄ deployment/            # Deploy configurations
‚îÇ   ‚îú‚îÄ‚îÄ cloudbuild.yaml   # CI/CD pipeline
‚îÇ   ‚îî‚îÄ‚îÄ integration-build.yaml # Integration deploy
‚îú‚îÄ‚îÄ docs/                  # Documentation
‚îÇ   ‚îú‚îÄ‚îÄ en/               # English documentation
‚îÇ   ‚îî‚îÄ‚îÄ pt-BR/            # Portuguese documentation
‚îî‚îÄ‚îÄ memory-bank/          # Technical documentation
    ‚îú‚îÄ‚îÄ activeContext.md   # Current state
    ‚îú‚îÄ‚îÄ progress.md        # Project progress
    ‚îî‚îÄ‚îÄ systemPatterns.md  # Architectural patterns
```

## üîÑ Integration Flow

1. **Client configures** email and endpoint
2. **Client maps** Source System ‚Üí Target System fields
3. **System generates** integration JSON
4. **Cloud Build** deploys to Application Integration
5. **Source system sends** webhook to integration
6. **Integration processes** and sends to client
7. **On error**, message is published to PubSub DLQ

## üìä Monitoring

### Execution Logs

```bash
# Cloud Run logs
gcloud logging read "resource.type=cloud_run_revision" --limit=50

# Application Integration logs
gcloud logging read "resource.type=integration" --limit=50
```

### Metrics

- Executions per minute
- Success/error rate
- Average latency
- Resource usage

## üõ°Ô∏è Security

- ‚úÖ Security headers configured
- ‚úÖ Input validation with Joi
- ‚úÖ Rate limiting
- ‚úÖ CORS configured
- ‚úÖ Non-root containers
- ‚úÖ Health checks

## ü§ù Contributing

1. Fork the project
2. Create a branch (`git checkout -b feature/new-feature`)
3. Commit your changes (`git commit -am 'Add new feature'`)
4. Push to the branch (`git push origin feature/new-feature`)
5. Open a Pull Request

## üìù License

This project is under the MIT license. See the [LICENSE](LICENSE) file for details.

## üÜò Support

For support, open an issue on GitHub or contact the development team.

---

**Built with ‚ù§Ô∏è to facilitate integrations on Google Cloud**
